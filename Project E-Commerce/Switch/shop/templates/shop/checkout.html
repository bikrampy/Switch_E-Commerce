{% extends 'shop/base.html' %}

{% load static %}

{% block title %}
About Us
{% endblock %}

{% block stylesheets %}
{{ block.super }}
<!-- Libraries Stylesheet -->
<link href="{% static 'shop/lib/animate/animate.min.css' %}" rel="stylesheet" />
<link
  href="{% static 'shop/lib/owlcarousel/assets/owl.carousel.min.css' %}"
  rel="stylesheet"
/>
<!-- Customized Bootstrap Stylesheet -->
<link href="{% static 'shop/css/style.css' %}" rel="stylesheet" />
{% endblock %}

{% block content %}
{{ block.super }}

    <!-- Breadcrumb Start -->
    <div class="container-fluid">
        <div class="row px-xl-5">
            <div class="col-12">
                <nav class="breadcrumb bg-light mb-30">
                    <a class="breadcrumb-item text-dark" href="{% url "shopIndex" %}">Home</a>
                    <a class="breadcrumb-item text-dark" href="{% url "productPage" %}">Shop</a>
                    <span class="breadcrumb-item active">Checkout</span>
                </nav>
            </div>
        </div>
    </div>
    <!-- Breadcrumb End -->


    <!-- Checkout Start -->
    <div class="container-fluid">
        <form action="{% url 'checkOut' %}" method="POST">
        {% csrf_token %}
        <div class="row px-xl-5">
            <div class="col-lg-8">
                <h5 class="section-title position-relative text-uppercase mb-3"><span class="bg-secondary pr-3">Billing Address</span></h5>
                <div class="bg-light p-30 mb-5">
                    <div class="row">
                        <div class="col-md-6 form-group">
                            <label>First Name</label>
                            <input class="form-control" type="text" placeholder="Shreyosi" name="first_name">
                        </div>
                        <div class="col-md-6 form-group">
                            <label>Last Name</label>
                            <input class="form-control" type="text" placeholder="Halder" name="last_name">
                        </div>
                        <div class="col-md-6 form-group">
                            <label>E-mail</label>
                            <input class="form-control" type="text" placeholder="example@email.com" name="email">
                        </div>
                        <div class="col-md-6 form-group">
                            <label>Mobile No</label>
                            <input class="form-control" type="text" placeholder="+91 12345 67890" name="phone">
                        </div>
                        <div class="col-md-6 form-group">
                            <label>Address Line 1</label>
                            <input class="form-control" type="text" placeholder="123 Street" name="address1">
                        </div>
                        <div class="col-md-6 form-group">
                            <label>Address Line 2</label>
                            <input class="form-control" type="text" placeholder="123 Street" name="address2">
                        </div>
                        <div class="col-md-6 form-group">
                            <label>Country</label>
                            <select class="custom-select">
                                <option selected>India</option>
                            </select>
                        </div>
                        <div class="col-md-6 form-group">
                            <label>City</label>
                            <input class="form-control" type="text" placeholder="Kolkata" name="city">
                        </div>
                        <div class="col-md-6 form-group">
                            <label>State</label>
                            <input class="form-control" type="text" placeholder="West Bengal" name="state">
                        </div>
                        <div class="col-md-6 form-group">
                            <label>ZIP Code</label>
                            <input class="form-control" type="text" placeholder="700 001" name="zip">
                        </div>
                        <div class="col-md-12">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="shipto">
                                <label class="custom-control-label" for="shipto"  data-toggle="collapse" data-target="#shipping-address">Ship to different address</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="collapse mb-5" id="shipping-address">
                    <h5 class="section-title position-relative text-uppercase mb-3"><span class="bg-secondary pr-3">Shipping Address</span></h5>
                    <div class="bg-light p-30">
                        <div class="row">
                            <div class="col-md-6 form-group">
                                <label>First Name</label>
                                <input class="form-control" type="text" placeholder="Shreyosi">
                            </div>
                            <div class="col-md-6 form-group">
                                <label>Last Name</label>
                                <input class="form-control" type="text" placeholder="Halder">
                            </div>
                            <div class="col-md-6 form-group">
                                <label>E-mail</label>
                                <input class="form-control" type="text" placeholder="example@email.com">
                            </div>
                            <div class="col-md-6 form-group">
                                <label>Mobile No</label>
                                <input class="form-control" type="text" placeholder="+91 12345 67890">
                            </div>
                            <div class="col-md-6 form-group">
                                <label>Address Line 1</label>
                                <input class="form-control" type="text" placeholder="123 Street">
                            </div>
                            <div class="col-md-6 form-group">
                                <label>Address Line 2</label>
                                <input class="form-control" type="text" placeholder="123 Street">
                            </div>
                            <div class="col-md-6 form-group">
                                <label>Country</label>
                                <select class="custom-select">
                                    <option selected>India</option>
                                </select>
                            </div>
                            <div class="col-md-6 form-group">
                                <label>City</label>
                                <input class="form-control" type="text" placeholder="Kolkata">
                            </div>
                            <div class="col-md-6 form-group">
                                <label>State</label>
                                <input class="form-control" type="text" placeholder="West Bengal">
                            </div>
                            <div class="col-md-6 form-group">
                                <label>ZIP Code</label>
                                <input class="form-control" type="text" placeholder="700 001">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <h5 class="section-title position-relative text-uppercase mb-3"><span class="bg-secondary pr-3">Order Total</span></h5>
                <div class="bg-light p-30 mb-5">
                  <div class="border-bottom">
                    <h6 class="mb-3">Products</h6>
                    <div id="checkout-products"></div>
                  </div>
                  <div class="border-bottom pt-3 pb-2">
                    <div class="d-flex justify-content-between mb-3">
                      <h6>Subtotal</h6>
                      <h6 id="subtotal">₹0</h6>
                    </div>
                    <div class="d-flex justify-content-between">
                      <h6 class="font-weight-medium">Shipping</h6>
                      <h6 class="font-weight-medium" id="shipping">₹50</h6>
                    </div>
                  </div>
                  <div class="pt-2">
                    <div class="d-flex justify-content-between mt-2">
                      <h5>Total</h5>
                      <h5 id="total">₹0</h5>
                    </div>
                  </div>
                </div>
                <div class="mb-5">
                    <h5 class="section-title position-relative text-uppercase mb-3"><span class="bg-secondary pr-3">Payment</span></h5>
                    <div class="bg-light p-30">
                        <div class="form-group">
                            <div class="custom-control custom-radio">
                                <input type="radio" class="custom-control-input" name="payment" id="paypal">
                                <label class="custom-control-label" for="paypal">Cash On Delivery</label>
                            </div>
                        </div>
                        <button type="button" id="clear-cart" class="btn btn-block btn-danger font-weight-bold py-3 mb-2">Clear Cart</button>
                        <button class="btn btn-block btn-primary font-weight-bold py-3">Place Order</button>
                    </div>
                </div>
            </div>
        </div>
        <input type="hidden" name="itemsJson" id="itemsJson" />
        </form>
    </div>
    <!-- Checkout End -->

{% endblock %}

{% block scripts %}
{{ block.super }}
<script src="{% static 'shop/lib/easing/easing.min.js' %}"></script>
<script src="{% static 'shop/lib/owlcarousel/owl.carousel.min.js' %}"></script>
<!-- Template Javascript -->
<script src="{% static 'shop/js/main.js' %}"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const cart = JSON.parse(localStorage.getItem('cart')) || {};
    const container = document.getElementById('checkout-products');
    let subtotal = 0;

    for (const key in cart) {
      const item = cart[key];
      const priceNum = parseInt(item.price.replace(/[₹,]/g, ""));
      const totalItemPrice = item.quantity * priceNum;
      subtotal += totalItemPrice;

      const div = document.createElement('div');
      div.classList.add('d-flex', 'justify-content-between');
      div.innerHTML = `<p>${item.name} × ${item.quantity}</p><p>₹${totalItemPrice}</p>`;
      container.appendChild(div);
    }

    document.getElementById('subtotal').innerText = `₹${subtotal}`;
    const shipping = 50;
    document.getElementById('total').innerText = `₹${subtotal + shipping}`;

    document.getElementById('itemsJson').value = JSON.stringify(cart);
  });

  document.getElementById('clear-cart').addEventListener('click', function () {
    if (confirm('Are you sure you want to clear the cart?')) {
      localStorage.removeItem('cart');
      location.reload();
    }
  });
</script>
{% endblock %}
